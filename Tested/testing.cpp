#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include "sm_TM_consts.h"
#include "sm_TM_CP.h"
#include "sm_TM_RBM.h"
#include "sm_TM_CP_inputsort.h"
#include "sm_TM_SNT_matched.h"

#include <fstream>
#include <iostream>
using namespace std;

int main()
{//return 0;}
int len1, len2, len3;
cin>>len1>>len2>>len3;


double prev1[40][3]; /*= {-0.000531854668928445 , 0.000536822478659031 , 31 ,
0.000174811387801959 , 6.06591576456439e-05 , 32 ,
-0.00014736042532269 , -0.000347602816018663 , 409 ,
0.00017492050135862 , 6.02512834854483e-05 , 633 ,
-0.00154957670735819 , 0.000620723349416174 , 1129 ,
0.000196275671443208 , 0.000571760851120811 , 1500 ,
-0.00108910125180426 , 0.000299894489814853 , 2377 ,
-0.000953994883635548 , 0.000571901574497615 , 2436 ,
-0.00162302324129016 , -0.000859242150931008 , 4066 ,
-0.000871446398392138 , 0.000373167270849591 , 4530 ,
-3.52948968989021e-05 , -0.000955681988969366 , 4915 ,
-0.00108365903823298 , 0.00130861664371708 , 6136 ,
0.000144736062754743 , -0.000493573154052957 , 6310 ,
-0.000867928887771225 , 0.000646300753712287 , 6542 ,
-0.000791894813117474 , 0.00130442503270168 , 6726 ,
0.000554304955911809 , 0.000261717244810115 , 7059 ,
0.000981529533848575 , -0.00141495849983279 , 7060 ,
-0.00169196224897532 , -0.000770909732210305 , 7776 ,
0.00138105639488789 , -0.00131256924868169 , 7777 ,
-0.000647327254098672 , -0.000750582731980917 , 7955 ,
0.00030888486398455 , -0.000540894981224253 , 8040 ,
-0.000670154616544446 , -0.00144931820871564 , 8397
}; //COPY-PASTE FROM TESTCASE.PY*/


double prev2[40][3];/* = {-0.000609738722571973 , 0.000616219282721142 , 31 ,
9.5928196789742e-05 , 0.000138477958403016 , 32 ,
-0.000227130184825685 , -0.000269079095482133 , 409 ,
9.60364174742271e-05 , 0.000138069845449983 , 633 ,
-0.00162745323539748 , 0.000702386611956963 , 1129 ,
0.000118509946004897 , 0.000649548530656322 , 1500 ,
-0.00116756102109283 , 0.000380495598480784 , 2377 ,
-0.00103185861626696 , 0.000652237111583389 , 2436 ,
-0.00170399181658026 , -0.000777548830897809 , 4066 ,
-0.000949719577024676 , 0.000453297092353428 , 4530 ,
-0.0001163864522001 , -0.000877356667196935 , 4915 ,
-0.00115998935015474 , 0.00138937522604034 , 6136 ,
6.46429015946528e-05 , -0.00041567195892073 , 6310 ,
-0.000945621708738393 , 0.00072645540745928 , 6542 ,
-0.000775826612458758 , -0.00140716365714308 , 6672 ,
-0.000868176258897126 , 0.00138452326457154 , 6726 ,
0.000475852094615082 , 0.000338705457473305 , 7059 ,
0.000899299811563238 , -0.00133869915444376 , 7060 ,
-0.00177275842708662 , -0.000689068829339502 , 7776 ,
0.00129896814326048 , -0.00123717107324792 , 7777 ,
-0.000727974051127623 , -0.00067097097683603 , 7955 ,
0.000228679274613576 , -0.000463343022636152 , 8040 ,
-0.000752293827314916 , -0.00136959718594213 , 8397
 }; //COPY-PASTE FROM TESTCASE.PY*/

for (int h=0; h<len1; h++) cin>>prev1[h][2]>>prev1[h][0]>>prev1[h][1];
for (int h=0; h<len2; h++) cin>>prev2[h][2]>>prev2[h][0]>>prev2[h][1];

double p1[40][3];
double p2[40][3];
int comm;
comm = sm_TM_CP_inputsort(prev1, len1, prev2, len2, p1, p2);

double pred[40][3];
sm_TM_CP(p1, p2, FOCAL_LENGTH, pred, comm, 1);

//TO CHECK CP OUTPUT--------------------
/*for (int i=0; i<comm; i++)
    cout<<pred[i][0]<<' '<<pred[i][1]<<' '<<pred[i][2]<<endl;
cout<<endl<<endl;*/


//TO CHECK CP + RBM OUTPUT---------------
double truemat[40][2];/* = {-0.000687541667625862 , 0.00069573567533286 ,
1.71352821651151e-05 , 0.000216408650998282 ,
-0.000306810607097482 , -0.000190446028639086 ,
1.72426131870108e-05 , 0.000216000294960379 ,
-0.00170525904296106 , 0.00078417548058644 ,
4.08320480829856e-05 , 0.000727452764800514 ,
-0.00124594402452333 , 0.00046121671884584 ,
-0.00110964550231849 , 0.000732694657586379 ,
-0.00178488353267518 , -0.000695744756113897 ,
-0.00102791417715185 , 0.000533546569015911 ,
-0.000197384167769219 , -0.000798928398513574 ,
-1.53572510788638e-05 , -0.000337664018180515 ,
-0.00102323718296401 , 0.000806732359622917 ,
-0.00085795600097707 , -0.00132728856383739 ,
0.000397492010886005 , 0.000415805853654375 ,
0.000817176916768941 , -0.00126234490425229 ,
-0.00185347892172119 , -0.000607115911343838 ,
0.00121698999317072 , -0.00116167823981453 ,
-0.000808534360743945 , -0.000591251741174296 ,
0.000148568566875983 , -0.000385685414999036 ,
-0.000834342912094459 , -0.00128977571691641
}; //COPY-PASTE FROM TESTCASE.PY*/

for (int h=0; h<len3; h++) cin>>truemat[h][0]>>truemat[h][1];

double matchmat[40][5];
int good = 0;
int num = 18;
double r = num*pixel_size;
good = sm_TM_RBM(pred, comm, truemat, len3, r, true, true, matchmat);

cout<<endl<<endl;
for (int i=0; i<good; i++)
    cout<<matchmat[i][4]<<' '<<matchmat[i][2]<<' '<<matchmat[i][3]<<endl;//<<' '<<matchmat[i][3]<<' '<<matchmat[i][4]<<' '<<endl;

cout<<endl<<endl<<good<<" out of "<<comm<<endl<<endl;

int snt[5060][11];

fstream newfile;
newfile.open("sm_TM_SNT.txt", ios::in);

int x, c=0;
while (newfile>>x)
{snt[c/11][c%11] = x;
c++;
}


fstream file;
file.open("Guide_Star_5060.txt", ios::in);

double gd_sc[5060][4];
c=0;
double y;
while (file>>y)
{gd_sc[c/4][c%4] = y;
c++;
}



double e = 0.00001;
double snt_out[5][3], snt_match=0;
snt_match = sm_TM_SNT_match(matchmat, good, truemat, len3, snt, gd_sc, FOCAL_LENGTH, 1, 20, e, snt_out);

for (int i=0; i<snt_match; i++)
    cout<<snt_out[i][0]<<' '<<snt_out[i][1]<<' '<<snt_out[i][2]<<endl;

cout<<endl<<endl<<snt_match<<endl;


}
